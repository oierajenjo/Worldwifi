package maps;

import java.io.IOException;
import java.net.MalformedURLException;
import java.net.URL;
import java.util.ArrayList;
import java.util.Collections;
import java.util.Comparator;

import org.json.JSONArray;
import org.json.JSONException;
import org.json.JSONObject;

import maps.Funciones;
import windows.Ubicacion;


public class FuncionesVariasWifis {
//	https://maps.googleapis.com/maps/api/distancematrix/json?units=km&mode=walking&origins=40.41721%2C-3.70379&destinations=40.40236126%2C-3.677293175%7C40.41817158%2C-3.677392762%7C40.39702079%2C-3.673881352%7C40.41250111%2C-3.676499075%7C40.413394%2C-3.674787206%7C40.41660911%2C-3.679593037%7C40.41906024%2C-3.684061539%7C40.39982891%2C-3.621281891%7C40.40227048%2C-3.605984533%7C40.40219442%2C-3.608458586%7C40.40219442%2C-3.608458586%7C40.39982891%2C-3.621281891%7C40.40210302%2C-3.623918941%7C40.40349615%2C-3.609330589%7C40.40528365%2C-3.608627823%7C40.40529272%2C-3.60861612%7C40.41151901%2C-3.697739489%7C40.40966697%2C-3.701574292%7C40.41182993%2C-3.702928583%7C40.42793844%2C-3.710240347%7C40.42471328%2C-3.710229998%7C40.42738668%2C-3.710599996%7C40.42802889%2C-3.710182354%7C40.41449175%2C-3.71108901%7C40.412079%2C-3.710816103%7C40.40740551%2C-3.711921894%7C40.41410291%2C-3.709859121%7C40.42577055%2C-3.700845661%7C40.42664222%2C-3.699722995%7C40.44476894%2C-3.669193147%7C40.44516135%2C-3.669880971%7C40.44476894%2C-3.669193147%7C40.46745338%2C-3.684611277%7C40.44489723%2C-3.678097292%7C40.44489723%2C-3.678097292%7C40.44810636%2C-3.676230962%7C40.44810636%2C-3.676230962%7C40.47504564%2C-3.577805997%7C40.47479358%2C-3.577768445%7C40.47340242%2C-3.578523319%7C40.45463576%2C-3.587632115%7C40.45531141%2C-3.587638002%7C40.45531141%2C-3.587638002%7C40.46055947%2C-3.593746181%7C40.46062284%2C-3.593687766%7C40.49041563%2C-3.655356752%7C40.47612371%2C-3.663900617%7C40.47280872%2C-3.639885124%7C40.47571688%2C-3.646672578%7C40.47685985%2C-3.642035334%7C40.47455678%2C-3.643075134%7C40.46344473%2C-3.632365316%7C40.46299114%2C-3.657154277%7C40.46337731%2C-3.631515435%7C40.46088954%2C-3.654421019%7C40.37164289%2C-3.692062783%7C40.36968951%2C-3.708167914%7C40.38985613%2C-3.707471879%7C40.38241253%2C-3.710751575%7C40.38109584%2C-3.710973351%7C40.38429664%2C-3.709086653%7C40.38626143%2C-3.700082523%7C40.36676832%2C-3.701141063%7C40.36676832%2C-3.701141063%7C40.382819%2C-3.606140062%7C40.37889982%2C-3.621454786%7C40.37958462%2C-3.623110349%7C40.37732438%2C-3.621240048%7C40.37790196%2C-3.622729661%7C40.39859981%2C-3.636895936%7C40.39922277%2C-3.636654344%7C40.39887769%2C-3.642036319%7C40.40939174%2C-3.653214777%7C40.40971738%2C-3.652982211%7C40.40609592%2C-3.646536107%7C40.38517937%2C-3.644462814%7C40.38517937%2C-3.644462814%7C40.3887193%2C-3.663689576%7C40.3887193%2C-3.663689576%7C40.39786211%2C-3.667066993%7C40.3936123%2C-3.655607387%7C40.39318997%2C-3.655414765%7C40.39009728%2C-3.665329064%7C40.39664109%2C-3.666336151%7C40.39502396%2C-3.665554302%7C40.38629368%2C-3.671865801%7C40.37641667%2C-3.669282114%7C40.37358564%2C-3.660254606%7C40.37641667%2C-3.669282114%7C40.37358564%2C-3.660254606%7C40.37358564%2C-3.660254606%7C40.48106787%2C-3.693350463%7C40.49504564%2C-3.688007026%7C40.49504578%2C-3.687983426%7C40.48025613%2C-3.721468678%7C40.51990209%2C-3.777376989%7C40.51967355%2C-3.777870157%7C40.51967331%2C-3.777905569%7C40.47900813%2C-3.709138378%7C40.47852634%2C-3.709841173%7C40.47900813%2C-3.709138378%7C40.47860087%2C-3.709440834%7C40.47860087%2C-3.709440834%7C40.49082276%2C-3.721605433%7C40.45907131%2C-3.700271645%7C40.46571246%2C-3.69404181%7C40.46527083%2C-3.694072651%7C40.46903299%2C-3.697662007%7C40.46903299%2C-3.697662007%7C40.44863106%2C-3.704526502%7C40.45458138%2C-3.705284469%7C40.45406088%2C-3.709371362%7C40.45749513%2C-3.710539713%7C40.35074797%2C-3.677306442%7C40.35087114%2C-3.691508909%7C40.34854936%2C-3.686539662%7C40.34854936%2C-3.686539662%7C40.34233619%2C-3.690550474%7C40.34333382%2C-3.690949194%7C40.35639654%2C-3.694050185%7C40.34889585%2C-3.711200309%7C40.33475183%2C-3.700809561%7C40.34636268%2C-3.708524396%7C40.43519138%2C-3.718876324%7C40.43520939%2C-3.718876516%7C40.43424298%2C-3.720717254%7C40.45786296%2C-3.712253737%7C40.46678159%2C-3.719566911%7C40.46711527%2C-3.719511494%7C40.46711527%2C-3.719511494%7C40.42753878%2C-3.732422725%7C40.45843104%2C-3.785855667%7C40.44668323%2C-3.704836343%7C40.44613327%2C-3.69896993%7C40.43998746%2C-3.700733879%7C40.43384095%2C-3.711446073%7C40.43371191%2C-3.71045436%7C40.40647389%2C-3.732701092%7C40.40647389%2C-3.732701092%7C40.40647389%2C-3.732701092%7C40.39976468%2C-3.775144918%7C40.39869732%2C-3.767685328%7C40.40731633%2C-3.747465417%7C40.40731633%2C-3.747465417%7C40.40512065%2C-3.748466414%7C40.40512065%2C-3.748466414%7C40.40731633%2C-3.747465417%7C40.40159394%2C-3.749110841%7C40.40178274%2C-3.749171856%7C40.39597072%2C-3.756271685%7C40.39707463%2C-3.766488547%7C40.39552931%2C-3.756266746%7C40.38493635%2C-3.764230286%7C40.37963665%2C-3.765949245%7C40.3788538%2C-3.781961611%7C40.3797961%2C-3.769072879%7C40.38298359%2C-3.780089056%7C40.39062532%2C-3.69051327%7C40.39065927%2C-3.693871604%7C40.40039462%2C-3.688421234%7C40.40044959%2C-3.688268601%7C40.40044959%2C-3.688268601%7C40.39338778%2C-3.698565633%7C40.39338778%2C-3.698565633%7C40.39415981%2C-3.699021366%7C40.39452275%2C-3.700085596%7C40.40003653%2C-3.707448815%7C40.40294595%2C-3.689637465%7C40.4020728%2C-3.695532539%7C40.45224738%2C-3.658040229%7C40.45252617%2C-3.658125501%7C40.43316517%2C-3.651876723%7C40.4359777%2C-3.637024481%7C40.43644465%2C-3.637300067%7C40.42958439%2C-3.641349741%7C40.42395169%2C-3.628600305%7C40.43587011%2C-3.636929143%7C40.42395169%2C-3.628600305%7C40.43641736%2C-3.637346971%7C40.42941133%2C-3.641689984%7C40.42285091%2C-3.65168284%7C40.42447061%2C-3.650425332%7C40.42342659%2C-3.651841641%7C40.42342659%2C-3.651841641%7C40.43664779%2C-3.611362971%7C40.44640229%2C-3.61179332%7C40.44477475%2C-3.612910584%7C40.42027705%2C-3.621741079%7C40.42023163%2C-3.621811386%7C40.42027705%2C-3.621741079%7C40.43447679%2C-3.609621954%7C40.43329163%2C-3.610566231%7C40.44842893%2C-3.598096989%7C40.44681859%2C-3.572741164%7C40.42732327%2C-3.683768008%7C40.42938854%2C-3.664855511%7C40.42206602%2C-3.662968076%7C40.42935271%2C-3.664819791%7C40.4334991%2C-3.669116778%7C40.4334991%2C-3.669116778%7C40.4319931%2C-3.670929244%7C40.43200211%2C-3.670929333%7C40.3742029%2C-3.751033745%7C40.38684744%2C-3.727740327%7C40.38607503%2C-3.723054719%7C40.39495991%2C-3.732764799%7C40.39758507%2C-3.720738633%7C40.38575188%2C-3.739957771%7C40.38330594%2C-3.742063386&key=AIzaSyBYkY-T5vBk-1uvs8lSrOuXNcqrjID65H0
	//	https://maps.googleapis.com/maps/api/distancematrix/json?units=km&mode=walking&origins=40.6655101,-73.89188969999998&destinations=40.6905615%2C-73.9976592%7C40.6905615%2C-73.9976592%7C40.6905615%2C-73.9976592%7C40.6905615%2C-73.9976592%7C40.6905615%2C-73.9976592%7C40.6905615%2C-73.9976592%7C40.659569%2C-73.933783%7C40.729029%2C-73.851524%7C40.6860072%2C-73.6334271%7C40.598566%2C-73.7527626%7C40.659569%2C-73.933783%7C40.729029%2C-73.851524%7C40.6860072%2C-73.6334271%7C40.598566%2C-73.7527626&key=AIzaSyBYkY-T5vBk-1uvs8lSrOuXNcqrjID65H0
	public static ArrayList<Distance> getDistanciasTotalFromJson(URL url_dis) {
		ArrayList<Distance> distancias = new ArrayList<Distance>();
		try {

			JSONObject json = Funciones.readJsonFromUrl(url_dis);
			JSONArray arr_des = json.getJSONArray("destination_addresses");
			JSONArray arr_ro = json.getJSONArray("rows");
			JSONArray arr_dis = arr_ro.getJSONArray(0);
			//					getJSONArray("elements");
			for(int i = 0; i < arr_des.length(); i++) {
				Distance distancia = new Distance(null, 0, 0, null, null);
				distancia.setDestino(arr_des.get(i).toString());
				distancia.setDis_m(arr_dis.getJSONObject(i).getJSONObject("distance").getInt("value"));
				distancia.setDis_seg(arr_dis.getJSONObject(i).getJSONObject("duration").getInt("value"));
				distancia.setkmTexto(arr_dis.getJSONObject(i).getJSONObject("distance").getString("text"));
				distancia.setTimeTexto(arr_dis.getJSONObject(i).getJSONObject("duration").getString("text"));
				distancias.add(distancia);
			}
		} catch (JSONException e) {
			e.printStackTrace();
		} catch (IOException e) {
			e.printStackTrace();
		}
		Collections.sort(distancias, Comparator.comparingInt(Distance::getDis_m));
		return distancias;		
	}


	public static Distance getDistanciaTotalFromJson(URL url_dis) throws JSONException,IOException {
		Distance distancia = new Distance();
		JSONObject json = Funciones.readJsonFromUrl(url_dis);
		JSONArray arr_des = json.getJSONArray("destination_addresses");
		JSONArray arr_ro = json.getJSONArray("rows");
		JSONArray arr_dis = new JSONArray();
		System.out.println(arr_ro.length());
		arr_dis =	arr_ro.getJSONObject(0).getJSONArray("elements");

		//					getJSONArray("elements");
		distancia.setDestino(arr_des.toString());
		//				for(int i = 0; i < arr_dis.length(); i++) {
		distancia.setDestino(arr_des.get(0).toString());
		//					distancia.setDis_m(arr_dis.getJSONObject(i).getJSONObject("distance").getInt("value"));
		//					distancia.setDis_seg(arr_dis.getJSONObject(i).getJSONObject("duration").getInt("value"));
		//					distancia.setkmTexto(arr_dis.getJSONObject(i).getJSONObject("distance").getString("text"));
		//					distancia.settimeTexto(arr_dis.getJSONObject(i).getJSONObject("duration").getString("text"));
		//				}

		distancia.setDis_m(arr_dis.getJSONObject(0).getJSONObject("distance").getInt("value"));
		distancia.setDis_seg(arr_dis.getJSONObject(0).getJSONObject("duration").getInt("value"));
		distancia.setkmTexto(arr_dis.getJSONObject(0).getJSONObject("distance").getString("text"));
		distancia.setTimeTexto(arr_dis.getJSONObject(0).getJSONObject("duration").getString("text"));
		System.out.println("");

		return distancia;		
	}

	public static URL getURLIndicacion (Ubicacion origen, Ubicacion destino) throws MalformedURLException {

		String origenS = origen.getDireccion();
		origenS = origenS.replace(", ", ",");
		origenS = origenS.replace(" ", "+");
		String destinoS = origen.getDireccion();
		destinoS = destinoS.replace(", ", ",");
		destinoS = destinoS.replace(" ", "+");

		String urlS = "https://www.google.com/maps/dir/?api=1&origin="+ origenS +"&destination=" + destinoS +"&travelmode=walking";
		URL url = new URL(urlS);
		return url;
	}


}
